<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="./material/material.min.css">
    <script src="./material/material.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.deep_purple-indigo.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://fonts.googleapis.com/css?family=Monoton" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" media="screen" charset="utf-8">
    <title>Liste d'évenement</title>
</head>

<body onload="getData()">
    <table class="mdl-data-table mdl-js-data-table  mdl-shadow--2dp">
        <thead>
            <tr>
                <th class="mdl-data-table__cell--non-numeric">Crée par</th>
                <th>Créateur Email</th>
                <th>Evénements / Lieu</th>
                <th>Détails</th>
                <th>Début</th>
                <th>Fin</th>
                <th id="uploadimg"><i class="material-icons">cloud_upload</i></th>
            </tr>
        </thead>
        <tbody id="nodeTable">
        </tbody>
    </table>
    </div>
    <script type="text/javascript">
    var requete;
    function getData() {
        requete = new XMLHttpRequest();
        requete.onerror = ajaxError;
        requete.onload = onDataReceived
        requete.open('GET', 'event.json', true);
        requete.send();
    }

    function ajaxError() {
        console.log("Error", e);

    }

    function onDataReceived() {
        var event = JSON.parse(this.responseText);
        var nodeTable = document.querySelector('#nodeTable');
        for (var i = 0; i < event.items.length; i++) {
            var eventTablerow = document.createElement('tr');
            var eventCreator = document.createElement('td');
            eventCreator.className = 'mdl-data-table__cell--non-numeric';
            var eventCreatorMail = document.createElement('td');
            var eventName = document.createElement('td');
            var eventDetails = document.createElement('td');
            var eventStart = document.createElement('td');
            var eventEnd = document.createElement('td');
            var eventUpload = document.createElement('td');
            var sendData = document.createElement("a");
            nodeTable.appendChild(eventTablerow);
            eventTablerow.appendChild(eventCreator);
            eventTablerow.appendChild(eventCreatorMail);
            eventTablerow.appendChild(eventName);
            eventTablerow.appendChild(eventDetails);
            eventTablerow.appendChild(eventStart);
            eventTablerow.appendChild(eventEnd);
            eventTablerow.appendChild(eventUpload);
            eventUpload.appendChild(sendData);
            sendData.innerHTML = "Enregistrer";
            eventCreator.innerHTML = event.items[i].creator.displayName;
            eventCreatorMail.innerHTML = event.items[i].creator.email;
            eventName.innerHTML = event.items[i].organizer.displayName;
            eventDetails.innerHTML = event.items[i].summary;
            eventStart.innerHTML = event.items[i].start.dateTime;
            eventEnd.innerHTML = event.items[i].end.dateTime;
            sendData.setAttribute("href", "pushDB.php?title=" + eventDetails.innerHTML + "&mail=" + eventCreatorMail.innerHTML + "&start=" + eventStart.innerHTML + "&end=" + eventEnd.innerHTML);
        }

    }

    function onDbData() {
    	requete = new XMLHttpRequest();
		requete.onerrorlog = ajaxError;
        requete.onload = onDbDataReceived;
        requete.open('GET', 'exploreDB.php', true);
        requete.send();
    }    	

    function onDbDataReceived() {
    	// console.log(JSON.parse(this.responseText));
    	var eventInDB = JSON.parse(this.responseText);
    	console.log(eventInDB[0]);

    }


    onDbData();


    </script>
</body>

</html>
